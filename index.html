<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  
  <title>PHASMO-TRACKER Ultimate (Smart AI)</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üëª</text></svg>">
  <meta name="google-site-verification" content="JgHSgqTfww6oZH2IdNMV8B5l6QsDQdTVgnMvWqpjd08" />
  <meta name="description" content="Tracker Phasmophobia avec recherche intelligente. D√©crivez une situation, l'outil trouve le fant√¥me et le test associ√©." />
  <meta name="author" content="Sebag Joshua & Logeais Ma√©lann" />
  <meta name="theme-color" content="#0f172a">

  <style>
    :root {
      --bg: #0f172a; --panel: #1e293b; --accent: #2dd4bf; --text: #f1f5f9;
      --border: #334155; --danger: #ef4444; --success: #10b981; --warn: #f59e0b; --purple: #a855f7;
      --nav-height: 60px;
    }
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body { margin: 0; font-family: 'Segoe UI', system-ui, sans-serif; background: var(--bg); color: var(--text); height: 100vh; display: flex; flex-direction: column; overflow: hidden; }

    /* LAYOUT */
    .app-layout { display: flex; height: 100%; width: 100%; overflow: hidden; }
    .controls-area { background: #020617; border-right: 1px solid var(--border); display: flex; flex-direction: column; z-index: 20; }
    .main-area { flex: 1; overflow-y: auto; padding: 15px; position: relative; scroll-behavior: smooth; }

    /* RESPONSIVE */
    @media (min-width: 900px) {
      .controls-area { width: 340px; padding: 20px; overflow-y: auto; }
      .mobile-nav, .mobile-proof-bar { display: none !important; }
      .pc-header { display: block; margin-bottom: 20px; font-size: 1.2rem; font-weight: 900; color: var(--accent); }
      .nav-pills { display: flex; gap: 5px; margin-bottom: 15px; background: #1e293b; padding: 5px; border-radius: 8px; }
      .nav-item { flex: 1; padding: 8px; border: none; background: transparent; color: #94a3b8; cursor: pointer; font-weight: bold; border-radius: 6px; }
      .nav-item.active { background: var(--accent); color: #000; }
      .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 15px; }
    }

    @media (max-width: 899px) {
      .app-layout { flex-direction: column; }
      .controls-area, .pc-header { display: none; }
      .mobile-nav {
        position: fixed; bottom: 0; left: 0; right: 0; height: var(--nav-height);
        background: #0f172a; border-top: 1px solid var(--border);
        display: flex; justify-content: space-around; align-items: center;
        z-index: 100; padding-bottom: env(safe-area-inset-bottom);
      }
      .mn-item { background: none; border: none; color: #64748b; font-size: 0.7rem; display: flex; flex-direction: column; align-items: center; gap: 4px; font-weight: bold; width: 100%; padding: 8px 0; }
      .mn-item.active { color: var(--accent); }
      .mn-icon { font-size: 1.2rem; }
      .mobile-proof-bar {
        position: sticky; top: 0; z-index: 50;
        background: rgba(15,23,42, 0.95); backdrop-filter: blur(10px);
        border-bottom: 1px solid var(--border);
        padding: 8px; display: flex; gap: 8px; overflow-x: auto;
        white-space: nowrap; -ms-overflow-style: none; scrollbar-width: none;
      }
      .mobile-proof-bar::-webkit-scrollbar { display: none; }
      .main-area { padding-bottom: 80px; }
      .grid { display: grid; grid-template-columns: 1fr; gap: 12px; }
    }

    /* COMPONENTS */
    .card { background: var(--panel); border: 1px solid var(--border); border-radius: 12px; padding: 12px; margin-bottom: 12px; }
    
    .proof-btn {
      flex: 0 0 auto; padding: 8px 12px; border: 1px solid var(--border); border-radius: 8px;
      background: #1e293b; color: #cbd5e1; font-weight: bold; font-size: 0.85rem;
      cursor: pointer; transition: 0.2s; user-select: none;
    }
    .proof-btn[data-state="inc"] { background: var(--success); color: #000; border-color: var(--success); }
    .proof-btn[data-state="exc"] { background: var(--danger); color: #fff; border-color: var(--danger); text-decoration: line-through; opacity: 0.7; }

    .ghost { background: var(--panel); border: 1px solid var(--border); border-radius: 12px; padding: 15px; position: relative; transition: 0.2s; }
    .ghost.excluded { display: none; }
    .ghost.manual-excluded { opacity: 0.4; order: 10; display: block; filter: grayscale(1); border-style: dashed; }
    .ghost.candidate { border-color: var(--accent); order: 1; box-shadow: 0 0 10px rgba(45,212,191,0.1); }
    
    .g-head { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }
    .g-name { font-size: 1.2rem; font-weight: 900; color: white; }
    .g-meta { font-size: 0.8rem; color: #94a3b8; display: flex; gap: 5px; margin-bottom: 8px; flex-wrap: wrap; }
    
    .g-actions { display: grid; grid-template-columns: 1fr 1fr 1fr auto; gap: 5px; margin-top: 8px; }
    .btn-action { padding: 8px; border-radius: 6px; border: 1px solid var(--border); background: #0f172a; color: #cbd5e1; font-weight: bold; font-size: 0.75rem; cursor: pointer; display: flex; justify-content: center; align-items: center; gap: 5px; }
    .btn-action.active { background: var(--accent); color: black; animation: pulse 1s infinite; border-color: var(--accent); }
    
    .g-details { display: none; margin-top: 10px; padding-top: 10px; border-top: 1px dashed var(--border); font-size: 0.85rem; line-height: 1.5; color: #e2e8f0; }
    .g-details.open { display: block; animation: slideDown 0.3s ease-out; }
    .g-details h5 { color: var(--accent); margin: 10px 0 4px 0; text-transform: uppercase; font-size: 0.75rem; letter-spacing: 1px; border-bottom: 1px solid #333; padding-bottom: 2px; }
    
    .obj-card { display: flex; gap: 10px; margin-bottom: 15px; align-items: flex-start; }
    .obj-icon { font-size: 2rem; min-width: 40px; }
    .obj-info h4 { margin: 0 0 5px 0; color: var(--accent); }
    .obj-info p { margin: 0; font-size: 0.85rem; color: #cbd5e1; }
    .risk { color: var(--danger); font-weight: bold; font-size: 0.8rem; }

    .hidden { display: none !important; }
    .text-center { text-align: center; }
    .search-input { width: 100%; padding: 12px; background: #0f172a; border: 1px solid var(--accent); color: white; border-radius: 8px; margin-bottom: 10px; font-size: 1rem; }
    @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.6; } 100% { opacity: 1; } }
    @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
    
    .badge { font-size: 0.7rem; padding: 2px 6px; background: #000; border-radius: 4px; color: #64748b; border: 1px solid #333; }
    .badge.match { color: var(--success); border-color: var(--success); }
    .val-fast { color: var(--danger); font-weight: bold; }
    .val-slow { color: var(--purple); font-weight: bold; }
  </style>
</head>
<body>

<div class="mobile-proof-bar" id="mobile-proofs"></div>

<div class="app-layout">
  
  <aside class="controls-area">
    <div class="pc-header">PHASMO ULTIMATE üëª</div>
    <div class="nav-pills">
      <button class="nav-item active" onclick="setTab('tracker')">JOURNAL</button>
      <button class="nav-item" onclick="setTab('tools')">OUTILS</button>
      <button class="nav-item" onclick="setTab('guides')">GUIDES</button>
    </div>
    <div id="pc-proofs-list" style="display: flex; flex-direction: column; gap: 5px;"></div>
    <div style="margin-top: 20px; text-align: center; font-size: 0.8rem; color: #64748b; border-top: 1px solid #333; padding-top: 10px;">
      Dev: <span style="color:var(--accent)">Sebag Joshua</span> & <span style="color:var(--accent)">Logeais Ma√©lann</span>
    </div>
  </aside>

  <main class="main-area" id="main-content">
    
    <div id="view-tracker">
      <input type="text" class="search-input" placeholder="üîç D√©crivez la situation (ex: sel, √©teint la lumi√®re, rapide...)" oninput="setSearch(this.value)">
      <div id="ghost-grid" class="grid"></div>
    </div>

    <div id="view-tools" class="hidden">
      <div class="card">
        <h4 style="margin:0 0 10px 0; color:var(--accent)">CHRONO ‚è±Ô∏è</h4>
        <div class="text-center" style="font-size:2rem; font-family:monospace; margin-bottom:10px" id="timer-disp">00:00</div>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:5px">
          <button class="btn-action" onclick="runTimer(90)">90s (Encens)</button>
          <button class="btn-action" onclick="runTimer(180)">180s (Esprit)</button>
          <button class="btn-action" style="grid-column: span 2; border-color:var(--danger)" onclick="stopTimer()">STOP</button>
        </div>
      </div>

      <div class="card">
        <h4 style="margin:0 0 10px 0; color:var(--accent)">M√âTRONOME üîä</h4>
        <div style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:5px">
          <button class="btn-action metro-btn" onclick="startMetronome(1.0, this)">üê¢ 1.0</button>
          <button class="btn-action metro-btn" onclick="startMetronome(1.7, this)">üö∂ 1.7</button>
          <button class="btn-action metro-btn" onclick="startMetronome(2.5, this)">üêá 2.5</button>
        </div>
        <button class="btn-action metro-btn" style="width:100%; margin-top:5px" onclick="stopMetronome()">üõë STOP SON</button>
        <button class="btn-action" style="width:100%; margin-top:5px" onmousedown="tapBpm()">üë£ TAPOTER RYTHME</button>
        <div id="bpm-val" class="text-center" style="margin-top:5px; font-weight:bold; color:#cbd5e1">-- m/s</div>
      </div>

      <div class="card">
        <h4 style="margin:0 0 10px 0; color:var(--accent)">OBJETS MAUDITS üó∫Ô∏è</h4>
        <select class="search-input" onchange="loadLocs(this.value)">
          <option value="">-- CHOISIR UNE CARTE --</option>
          <option value="tanglewood">6 Tanglewood Drive</option>
          <option value="willow">Willow Street</option>
          <option value="edgefield">42 Edgefield Road</option>
          <option value="ridgeview">10 Ridgeview Court</option>
          <option value="grafton">Grafton Farmhouse</option>
          <option value="bleasdale">Bleasdale Farmhouse</option>
          <option value="woodwind">Camp Woodwind</option>
          <option value="prison">Prison</option>
          <option value="sunny">Sunny Meadows</option>
        </select>
        <div id="loc-area"></div>
      </div>

      <div class="card">
        <div style="display:flex; justify-content:space-between;"><span>üß† Sant√© Mentale</span><span id="san-disp" style="color:var(--accent)">100%</span></div>
        <input type="range" style="width:100%" min="0" max="100" value="100" oninput="setSan(this.value)">
      </div>
    </div>

    <div id="view-guides" class="hidden">
      
      <div class="card">
        <h4 style="color:var(--accent); margin-top:0; border-bottom:1px solid #333; padding-bottom:5px;">üîÆ OBJETS MAUDITS (D√âTAILS)</h4>
        
        <div class="obj-card">
          <div class="obj-icon">üé∂</div>
          <div class="obj-info">
            <h4>Bo√Æte √† Musique</h4>
            <p>Le fant√¥me chante. Si vous vous approchez trop ou si la bo√Æte touche le sol : <b>CHASSE</b>.</p>
            <span class="risk">Co√ªt : -75% Sant√© si √©cout√©e enti√®rement.</span>
          </div>
        </div>

        <div class="obj-card">
          <div class="obj-icon">üß∏</div>
          <div class="obj-info">
            <h4>Poup√©e Vaudou</h4>
            <p>Enfoncer une aiguille force une interaction. Si l'aiguille touche le c≈ìur : <b>CHASSE</b>.</p>
            <span class="risk">Co√ªt : -5% par aiguille (-10% c≈ìur).</span>
          </div>
        </div>

        <div class="obj-card">
          <div class="obj-icon">üîÆ</div>
          <div class="obj-info">
            <h4>Miroir Hant√©</h4>
            <p>Regarder dedans montre la pi√®ce du fant√¥me (vision panoramique).</p>
            <span class="risk">Co√ªt : -7.5% par seconde. Brise + CHASSE si 0%.</span>
          </div>
        </div>

        <div class="obj-card">
          <div class="obj-icon">‚≠ï</div>
          <div class="obj-info">
            <h4>Cercle d'Invocation</h4>
            <p>Allumer les 5 bougies invoque le fant√¥me. Il est pi√©g√© 5s puis chasse.</p>
            <span class="risk">Co√ªt : -16% par bougie (-80% total).</span>
          </div>
        </div>

        <div class="obj-card">
          <div class="obj-icon">üÉè</div>
          <div class="obj-info">
            <h4>Cartes de Tarot (10 Cartes)</h4>
            <p><b>Soleil:</b> 100% Sant√© | <b>Lune:</b> 0% Sant√©<br><b>Mort:</b> CHASSE | <b>Diable:</b> Event<br><b>Ermite:</b> Bloque 1min | <b>Pendu:</b> MORT imm√©diate.</p>
          </div>
        </div>

        <div class="obj-card">
          <div class="obj-icon">üß©</div>
          <div class="obj-info">
            <h4>Ouija Board</h4>
            <p>Posez des questions ("O√π es-tu?", "Quel √¢ge?"). Dites "Au revoir" sinon chasse.</p>
            <span class="risk">Co√ªt : -50% (Lieu), -5% (√Çge/Mort).</span>
          </div>
        </div>

        <div class="obj-card">
          <div class="obj-icon">‚úã</div>
          <div class="obj-info">
            <h4>Patte de Singe</h4>
            <p>Exauce des v≈ìux mais avec une punition grave (aveugle, sourd, chasse, mort).</p>
          </div>
        </div>
      </div>

      <div class="card">
        <h4 style="color:var(--accent); margin-top:0">üó∫Ô∏è LOCALISATION OBJETS</h4>
        <select class="search-input" onchange="loadLocs(this.value)">
          <option value="">-- CHOISIR UNE CARTE --</option>
          <option value="tanglewood">6 Tanglewood Drive</option>
          <option value="willow">Willow Street</option>
          <option value="edgefield">42 Edgefield Road</option>
          <option value="ridgeview">10 Ridgeview Court</option>
          <option value="grafton">Grafton Farmhouse</option>
          <option value="bleasdale">Bleasdale Farmhouse</option>
          <option value="woodwind">Camp Woodwind</option>
          <option value="prison">Prison</option>
          <option value="sunny">Sunny Meadows</option>
        </select>
        <div id="loc-area"></div>
      </div>

    </div>

  </main>
</div>

<nav class="mobile-nav">
  <button class="mn-item active" onclick="setTab('tracker', this)"><span class="mn-icon">üìì</span>Journal</button>
  <button class="mn-item" onclick="setTab('tools', this)"><span class="mn-icon">üß∞</span>Outils</button>
  <button class="mn-item" onclick="setTab('guides', this)"><span class="mn-icon">üìñ</span>Guides</button>
  <button class="mn-item" style="color:var(--danger)" onclick="resetAll()"><span class="mn-icon">üóëÔ∏è</span>Reset</button>
</nav>

<script>
const PROOFS = [ { id:'emf', label:'EMF 5' }, { id:'orb', label:'Orbe' }, { id:'box', label:'Box' }, { id:'frz', label:'Froid' }, { id:'uv', label:'UV' }, { id:'dot', label:'DOTS' }, { id:'wrt', label:'Ecrit' } ];

const GHOSTS = [
  { n:'Esprit', p:['emf','box','wrt'], th:50, sp:'1.7', t:'Basique. Test Encens.', 
    d:'<h5>Test de l\'Encens</h5><p>Si vous utilisez de l\'encens pr√®s de lui, l\'Esprit ne peut <b>PAS</b> chasser pendant <b>180 secondes</b> (3 minutes). Les autres c\'est 90s.</p><h5>Comportement</h5><p>Aucun pouvoir sp√©cial. Vitesse normale.</p>' },
  { n:'Spectre', p:['dot','emf','box'], th:50, sp:'1.7', t:'Ne marche pas dans le sel. TP.', 
    d:'<h5>Test du Sel (100% S√ªr)</h5><p>Si un fant√¥me marche dans du sel sans laisser d\'empreinte de pied (UV ou visible), c\'est un Spectre. <b>Il ne marche JAMAIS dans le sel.</b></p><h5>T√©l√©portation</h5><p>Il peut se t√©l√©porter sur un joueur al√©atoire (donne EMF 2 ou 5).</p>' },
  { n:'Fant√¥me', p:['dot','uv','box'], th:50, sp:'1.7', t:'Disparition photo. Clignote lent.', 
    d:'<h5>Test Photo</h5><p>Si vous le prenez en photo (hors chasse), il dispara√Æt instantan√©ment de la vision mais pas de la photo (la photo montre "Fant√¥me" mais est vide).</p><h5>Chasse</h5><p>Il clignote tr√®s lentement (invisible longtemps). Il draine la sant√© si on le regarde.</p>' },
  { n:'Poltergeist', p:['uv','box','wrt'], th:50, sp:'1.7', t:'Jette plein d\'objets.', 
    d:'<h5>Test "Pile d\'objets"</h5><p>Faites une pile de 3-4 objets. Le Poltergeist peut tous les jeter en m√™me temps (Explosion). Si vous voyez plusieurs objets voler en simultan√©, c\'est lui.</p><h5>Sant√©</h5><p>Chaque objet jet√© baisse la sant√© mentale des joueurs proches.</p>' },
  { n:'Banshee', p:['dot','orb','uv'], th:50, sp:'1.7', t:'Cible unique. Cri micro.', 
    d:'<h5>Chasse & Cible</h5><p>Elle ne tue QUE sa cible. Elle ignore les autres joueurs (passe √† travers eux). Si la cible est dehors, elle chasse normalement.</p><h5>Micro Parabolique</h5><p>Chance d\'entendre un cri unique (sp√©cifique √† la Banshee) au micro.</p>' },
  { n:'Djinn', p:['emf','uv','frz'], th:50, sp:'2.5', t:'Rapide avec courant.', 
    d:'<h5>Pouvoir (Courant ON)</h5><p>Si le disjoncteur est allum√©, il sprint (2.5 m/s) vers vous s\'il vous voit de loin. Il ralentit (1.7 m/s) √† moins de 3 m√®tres.</p><h5>Capacit√© cach√©e</h5><p>Peut drainer 25% de sant√© instantan√©ment si vous √™tes pr√®s de lui (EMF 2 au disjoncteur).</p><p><b>Ne peut jamais √©teindre le disjoncteur.</b></p>' },
  { n:'Cauchemar', p:['orb','box','wrt'], th:60, sp:'1.7', t:'D√©teste la lumi√®re.', 
    d:'<h5>Lumi√®re vs Obscurit√©</h5><p>Chasse √† 60% de sant√© s\'il est dans le noir. Chasse √† 40% seulement si la lumi√®re est allum√©e.</p><h5>Test Interrupteur</h5><p>Il a une chance d\'√©teindre la lumi√®re imm√©diatement apr√®s que vous l\'ayez allum√©e. <b>Il ne peut pas allumer la lumi√®re.</b></p>' },
  { n:'Revenant', p:['orb','wrt','frz'], th:50, sp:'3.0', t:'Le plus dangereux.', 
    d:'<h5>Vitesse Extr√™me</h5><p><b>Cach√© (Pas de vue) :</b> Tr√®s lent (1.0 m/s), comme un joueur accroupi.<br><b>Vu (Ligne de vue) :</b> Acc√©l√®re instantan√©ment √† 3.0 m/s (impossible √† distancer sans encens). Ne courez pas en ligne droite !</p>' },
  { n:'Ombre', p:['emf','wrt','frz'], th:35, sp:'1.7', t:'Timide en groupe.', 
    d:'<h5>Timidit√©</h5><p>Ne chasse pas si plusieurs personnes sont dans la m√™me pi√®ce que lui. Tr√®s difficile √† trouver (peu d\'activit√©). Seuil de chasse tr√®s bas (35%).</p><h5>Events</h5><p>Pr√©f√®re les "events" de fum√©e (boule d\'air) plut√¥t que les apparitions physiques.</p>' },
  { n:'D√©mon', p:['wrt','uv','frz'], th:70, sp:'1.7', t:'Chasse tr√®s souvent.', 
    d:'<h5>Aggressivit√©</h5><p>Peut chasser d√®s 70% de sant√© mentale. A une capacit√© rare pour chasser √† 100% de sant√©.</p><h5>Cooldown</h5><p>Peut rechasser seulement 20 secondes apr√®s la fin d\'une chasse.</p><h5>Crucifix</h5><p>Les crucifix fonctionnent √† 5 m√®tres (au lieu de 3m).</p>' },
  { n:'Yurei', p:['dot','orb','frz'], th:50, sp:'1.7', t:'Draine sant√©. Portes.', 
    d:'<h5>Porte d\'entr√©e</h5><p>Seul fant√¥me capable de fermer compl√®tement la porte d\'entr√©e (hors chasse) et de la claquer. Cela draine 15% de sant√©.</p><h5>Test Encens</h5><p>L\'encens le pi√®ge dans sa pi√®ce pendant 90s (il ne peut pas en sortir).</p>' },
  { n:'Oni', p:['dot','emf','frz'], th:50, sp:'1.7', t:'Tr√®s visible. Actif.', 
    d:'<h5>Visibilit√© Chasse</h5><p>L\'Oni clignote tr√®s peu. Il est visible la plupart du temps pendant la chasse.</p><h5>Activit√©</h5><p>Tr√®s actif quand il y a du monde. Draine beaucoup de sant√© sur les events physiques (apparitions). <b>Ne fait jamais l\'event "Boule de fum√©e".</b></p>' },
  { n:'Yokai', p:['dot','orb','box'], th:80, sp:'1.7', t:'Sourd & Sensible voix.', 
    d:'<h5>Sensible √† la voix</h5><p>Peut chasser d√®s 80% de sant√© si vous parlez pr√®s de lui.</p><h5>Sourd (Chasse)</h5><p>Pendant une chasse, il n\'entend votre voix et votre √©quipement qu\'√† moins de 2 m√®tres. Vous pouvez courir derri√®re lui sans qu\'il vous rep√®re facilement.</p>' },
  { n:'Hantu', p:['orb','uv','frz'], th:50, sp:'2.7', t:'Vitesse thermique.', 
    d:'<h5>Froid = Rapide</h5><p>Tr√®s rapide (2.7 m/s) dans les pi√®ces froides/couloirs. Lent (1.4 m/s) dans les pi√®ces chaudes.</p><h5>Bu√©e</h5><p>Pendant la chasse, si le courant est coup√©, on peut voir sa respiration (bu√©e) sortir de sa bouche.</p><p><b>Ne peut pas allumer le courant.</b></p>' },
  { n:'Goryo', p:['dot','emf','uv'], th:50, sp:'1.7', t:'DOTS Cam√©ra.', 
    d:'<h5>Test DOTS Sp√©cial</h5><p>Ses DOTS ne sont visibles <b>QUE</b> via une cam√©ra vid√©o, et <b>SEULEMENT</b> si personne n\'est dans la pi√®ce avec lui.</p><h5>Roaming</h5><p>Il ne s\'√©loigne presque jamais de sa pi√®ce favorite.</p>' },
  { n:'Myling', p:['wrt','emf','uv'], th:50, sp:'1.7', t:'Pas silencieux.', 
    d:'<h5>Chasse Silencieuse</h5><p>Ses bruits de pas sont tr√®s faibles. Si vous entendez ses pas, c\'est qu\'il est d√©j√† tr√®s proche. Souvent, la lampe torche clignote AVANT que vous n\'entendiez ses pas.</p><h5>Sons paranormaux</h5><p>Fait beaucoup de bruits au micro parabolique.</p>' },
  { n:'Onryo', p:['orb','frz','box'], th:60, sp:'1.7', t:'Peur du feu.', 
    d:'<h5>Le Feu = Crucifix</h5><p>Une bougie allum√©e agit comme un crucifix. Si l\'Onryo souffle une bougie, il a une forte chance de lancer une chasse imm√©diatement (sauf s\'il y a une autre bougie ou un crucifix).</p><h5>Test</h5><p>S\'il souffle 3 bougies et ne chasse pas (alors qu\'il n\'y a pas de crucifix), ce n\'est probablement pas lui.</p>' },
  { n:'Jumeaux', p:['emf','frz','box'], th:50, sp:'Var', t:'Double interaction.', 
    d:'<h5>Leurre vs R√©el</h5><p>Un jumeau est dans la pi√®ce fant√¥me, l\'autre se balade. Vous pouvez avoir des interactions √† deux endroits oppos√©s simultan√©ment.</p><h5>Chasse</h5><p>50% de chance que le "Vrai" chasse (Vitesse 1.5 m/s - Lent).<br>50% de chance que le "Leurre" chasse (Vitesse 1.9 m/s - Rapide).</p>' },
  { n:'Raiju', p:['dot','emf','orb'], th:65, sp:'2.5', t:'Boost Elec.', 
    d:'<h5>Vitesse √âlectronique</h5><p>S\'il passe pr√®s d\'un √©quipement √©lectronique allum√© (lampe, dots, radio...), il acc√©l√®re instantan√©ment √† 2.5 m/s.</p><h5>Perturbation</h5><p>Il brouille les √©quipements √©lectroniques de beaucoup plus loin (15m) que les autres fant√¥mes (10m).</p>' },
  { n:'Obake', p:['emf','orb','uv'], th:50, sp:'1.7', t:'Changeur de forme.', 
    d:'<h5>Empreinte UV</h5><p>Seul fant√¥me √† laisser une empreinte de main √† 6 doigts (16% de chance). Peut aussi faire dispara√Ætre ses empreintes plus vite.</p><h5>Chasse (Shapeshift)</h5><p>Il a une chance de changer de mod√®le 3D pendant une fraction de seconde durant la chasse (on le voit clignoter bizarrement).</p>' },
  { n:'Mimic', p:['box','uv','frz'], th:50, sp:'Var', t:'Le Copieur.', 
    d:'<h5>Orbes Fant√¥mes</h5><p>Le Mimic a TOUJOURS des orbes fant√¥mes, m√™me en 0 preuve. C\'est sa "fausse" 4√®me preuve.</p><h5>Comportement</h5><p>Il copie n\'importe quel autre fant√¥me et change r√©guli√®rement. Il peut √™tre un Raiju rapide, puis devenir un Deogen lent, etc.</p>' },
  { n:'Moroi', p:['box','wrt','frz'], th:50, sp:'Var', t:'Maudit & Rapide.', 
    d:'<h5>Vitesse / Sant√©</h5><p>Plus votre sant√© mentale est basse, plus il est rapide. √Ä 0% de sant√©, il fonce √† 2.25 m/s.</p><h5>Spirit Box</h5><p>Si vous obtenez une r√©ponse √† la Spirit Box, vous √™tes "maudit" : votre sant√© mentale baisse deux fois plus vite, m√™me avec une lumi√®re/bougie.</p>' },
  { n:'Deogen', p:['dot','wrt','box'], th:40, sp:'3.0', t:'Vous trouve toujours.', 
    d:'<h5>Vision Totale</h5><p>Il sait toujours o√π vous √™tes. Se cacher est inutile, il viendra dans votre placard.</p><h5>Vitesse</h5><p>Tr√®s rapide de loin (3.0 m/s). Super lent (0.4 m/s) quand il est tout pr√®s de vous. Vous pouvez le "balader" en marchant autour d\'une table.</p><h5>Spirit Box</h5><p>Respiration lourde/Grogne unique si vous √™tes coll√© √† lui avec la Box.</p>' },
  { n:'Thaye', p:['dot','orb','wrt'], th:75, sp:'2.7', t:'Vieillissement.', 
    d:'<h5>Jeune (D√©but)</h5><p>Tr√®s actif, tr√®s rapide (2.75 m/s), chasse t√¥t (75%).</p><h5>Vieux (Fin)</h5><p>S\'il reste pr√®s des joueurs, il "vieillit". Il devient lent (1.0 m/s), moins actif et chasse moins (15%).</p><h5>Pas de Vitesse LOS</h5><p>Contrairement aux autres, il n\'acc√©l√®re pas s\'il vous voit (Ligne de vue).</p>' },
  { n:'Dayan', p:['emf','orb','box'], th:65, sp:'Var', t:'(Entit√© Custom/Mod)', 
    d:'<h5>Custom</h5><p>Cette entit√© n\'est pas officielle. Comportement variable selon le serveur.</p>' },
  { n:'Gallu', p:['emf','uv','box'], th:60, sp:'1.7', t:'(Entit√© Custom/Mod)', 
    d:'<h5>Custom</h5><p>Cette entit√© n\'est pas officielle. Comportement variable selon le serveur.</p>' },
  { n:'Obambo', p:['wrt','uv','dot'], th:60, sp:'Var', t:'(Entit√© Custom/Mod)', 
    d:'<h5>Custom</h5><p>Cette entit√© n\'est pas officielle. Comportement variable selon le serveur.</p>' }
];

const LOCATIONS = {
  'tanglewood': [ { i:'üîÆ', n:'Miroir', l:'Salon (Mur vers chambre)' }, { i:'üß©', n:'Ouija', l:'Sous-sol (Fond gauche)' }, { i:'üß∏', n:'Poup√©e', l:'Garage (Poubelle)' }, { i:'‚≠ï', n:'Cercle', l:'Sous-sol' }, { i:'üÉè', n:'Tarot', l:'Salon' }, { i:'üì¶', n:'Bo√Æte', l:'Nursery' }, { i:'‚úã', n:'Patte', l:'Salle √† manger' } ],
  'willow': [ { i:'üîÆ', n:'Miroir', l:'Couloir (Coin)' }, { i:'üß©', n:'Ouija', l:'Garage (Buanderie)' }, { i:'üß∏', n:'Poup√©e', l:'Chambre gar√ßons' }, { i:'‚≠ï', n:'Cercle', l:'Sous-sol' }, { i:'üÉè', n:'Tarot', l:'Salon' }, { i:'üì¶', n:'Bo√Æte', l:'Salon' }, { i:'‚úã', n:'Patte', l:'Couloir' } ],
  'edgefield': [ { i:'üîÆ', n:'Miroir', l:'1er √©tage' }, { i:'üß©', n:'Ouija', l:'Buanderie' }, { i:'üß∏', n:'Poup√©e', l:'1er √©tage (Ado)' }, { i:'‚≠ï', n:'Cercle', l:'Sous-sol' }, { i:'üÉè', n:'Tarot', l:'Entr√©e' }, { i:'üì¶', n:'Bo√Æte', l:'Salon' }, { i:'‚úã', n:'Patte', l:'Cuisine' } ],
  'ridgeview': [ { i:'üîÆ', n:'Miroir', l:'RDC (Escaliers)' }, { i:'üß©', n:'Ouija', l:'Buanderie' }, { i:'üß∏', n:'Poup√©e', l:'Couloir RDC' }, { i:'‚≠ï', n:'Cercle', l:'Sous-sol' }, { i:'üÉè', n:'Tarot', l:'Entr√©e' }, { i:'üì¶', n:'Bo√Æte', l:'Chambre Fille' }, { i:'‚úã', n:'Patte', l:'Chambre Gar√ßon' } ],
  'grafton': [ { i:'üîÆ', n:'Miroir', l:'Salon' }, { i:'üß©', n:'Ouija', l:'Chambre Master' }, { i:'üß∏', n:'Poup√©e', l:'Nursery' }, { i:'‚≠ï', n:'Cercle', l:'Entrep√¥t' }, { i:'üÉè', n:'Tarot', l:'Salle √† manger' }, { i:'üì¶', n:'Bo√Æte', l:'Entr√©e' }, { i:'‚úã', n:'Patte', l:'Chambre Jumelle' } ],
  'bleasdale': [ { i:'üîÆ', n:'Miroir', l:'Bureau RDC' }, { i:'üß©', n:'Ouija', l:'Atelier' }, { i:'üß∏', n:'Poup√©e', l:'Couloir 2e' }, { i:'‚≠ï', n:'Cercle', l:'Grenier' }, { i:'üÉè', n:'Tarot', l:'Bureau RDC' }, { i:'üì¶', n:'Bo√Æte', l:'Salon' }, { i:'‚úã', n:'Patte', l:'Chambre Master' } ],
  'woodwind': [ { i:'üîÆ', n:'Miroir', l:'Tente d√©part' }, { i:'üß©', n:'Ouija', l:'Zone Jeux' }, { i:'üß∏', n:'Poup√©e', l:'Tente rouge' }, { i:'‚≠ï', n:'Cercle', l:'Tente Nourriture' }, { i:'üÉè', n:'Tarot', l:'Entr√©e' }, { i:'üì¶', n:'Bo√Æte', l:'Tente Jaune' }, { i:'‚úã', n:'Patte', l:'Feu de camp' } ],
  'prison': [ { i:'üîÆ', n:'Miroir', l:'Entr√©e' }, { i:'üß©', n:'Ouija', l:'Arri√®re cellules A' }, { i:'üß∏', n:'Poup√©e', l:'Accueil' }, { i:'‚≠ï', n:'Cercle', l:'Caf√©t√©ria' }, { i:'üÉè', n:'Tarot', l:'Entr√©e' }, { i:'üì¶', n:'Bo√Æte', l:'Entr√©e' }, { i:'‚úã', n:'Patte', l:'Visiteurs' } ],
  'sunny': [ { i:'üîÆ', n:'Miroir', l:'Chapelle' }, { i:'üß©', n:'Ouija', l:'Chapelle' }, { i:'üß∏', n:'Poup√©e', l:'Chapelle' }, { i:'‚≠ï', n:'Cercle', l:'Chapelle' }, { i:'üÉè', n:'Tarot', l:'Chapelle' }, { i:'üì¶', n:'Bo√Æte', l:'Chapelle' }, { i:'‚úã', n:'Patte', l:'Chapelle' } ]
};

let state = { inc: [], exc: [], manual: [], san: 100, search: '' };
const AudioContext = window.AudioContext || window.webkitAudioContext;
const audioCtx = new AudioContext();
let metroId = null;
let tInterval = null;
let lastTap = 0;

function init() {
  loadState();
  renderProofs();
  renderGhosts();
  setTab('tracker');
}

function setTab(tabName, btnMobile) {
  document.getElementById('view-tracker').classList.add('hidden');
  document.getElementById('view-tools').classList.add('hidden');
  document.getElementById('view-guides').classList.add('hidden');
  document.getElementById('view-'+tabName).classList.remove('hidden');
  document.querySelectorAll('.mn-item').forEach(b => b.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
  if(btnMobile) btnMobile.classList.add('active'); 
  else {
    const pcBtns = document.querySelectorAll('.nav-item');
    if(tabName==='tracker') pcBtns[0].classList.add('active');
    if(tabName==='tools') pcBtns[1].classList.add('active');
    if(tabName==='guides') pcBtns[2].classList.add('active');
  }
}

function renderProofs() {
  const html = PROOFS.map(p => {
    let st = '';
    if(state.inc.includes(p.id)) st = 'data-state="inc"';
    if(state.exc.includes(p.id)) st = 'data-state="exc"';
    return `<button class="proof-btn" ${st} onclick="toggleProof('${p.id}')">${p.label}</button>`;
  }).join('');
  document.getElementById('mobile-proofs').innerHTML = html; 
  document.getElementById('pc-proofs-list').innerHTML = html.replace(/proof-btn/g, 'proof-btn btn-action'); 
}

function toggleProof(id) {
  if(state.inc.includes(id)) { state.inc = state.inc.filter(x=>x!==id); state.exc.push(id); } 
  else if(state.exc.includes(id)) { state.exc = state.exc.filter(x=>x!==id); } 
  else { state.inc.push(id); }
  saveState(); renderProofs(); renderGhosts();
}

function renderGhosts() {
  const container = document.getElementById('ghost-grid');
  container.innerHTML = GHOSTS.map(g => {
    let gp = [...g.p]; if(g.n==='Mimic') gp.push('orb');
    const impossible = state.inc.some(id => !gp.includes(id));
    const excluded = state.exc.some(id => { if(g.n==='Mimic' && id==='orb') return false; return gp.includes(id); });
    const manuallyKilled = state.manual.includes(g.n);
    let searchMatch = true;
    if(state.search) {
        const cleanDesc = g.d.replace(/<[^>]*>/g, ' ');
        const fullText = (g.n + ' ' + g.t + ' ' + cleanDesc).toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
        const searchText = state.search.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
        if(!fullText.includes(searchText)) searchMatch = false;
    }
    if((impossible || excluded) && !manuallyKilled) return ''; 
    let cls = 'ghost candidate'; if(manuallyKilled) cls = 'ghost manual-excluded';

    return `
      <div class="${cls}">
        <div class="g-head"><span class="g-name">${g.n}</span><span style="font-size:0.8rem; font-weight:bold; color:var(--accent)">${g.sp} m/s</span></div>
        <div class="g-meta">
          ${g.p.map(pid => {
            const lbl = PROOFS.find(x=>x.id===pid).label;
            const match = state.inc.includes(pid) ? 'match' : '';
            return `<span class="badge ${match}">${lbl}</span>`;
          }).join('')}
          ${g.n==='Mimic' ? '<span class="badge">Fake Orbe</span>' : ''}
        </div>
        <div style="font-size:0.85rem; color:#cbd5e1; margin-bottom:8px; line-height:1.4;">${g.t}</div>
        <div class="g-actions">
          <button class="btn-action metro-btn" onclick="toggleGhostMetro('${g.sp}', this)">üîä</button>
          <button class="btn-action" style="flex:2" onclick="toggleDetails('${g.n}')">üìñ D√âTAILS</button>
          <button class="btn-action" onclick="toggleManual('${g.n}')">${manuallyKilled ? '‚Ü∫' : '‚ùå'}</button>
        </div>
        <div id="details-${g.n}" class="g-details">${g.d}</div>
      </div>
    `;
  }).join('');
}

function toggleDetails(name) {
  const el = document.getElementById('details-'+name);
  if(el) el.classList.toggle('open');
}

function toggleManual(name) {
  if(state.manual.includes(name)) state.manual = state.manual.filter(x=>x!==name); else state.manual.push(name);
  saveState(); renderGhosts();
}
function setSearch(val) { state.search = val; renderGhosts(); }

function toggleGhostMetro(speed, btn) {
  if(btn.classList.contains('active')) { stopMetronome(); return; }
  stopMetronome(); let v = parseFloat(speed) || 1.7; startMetronome(v, btn);
}
function startMetronome(speed, btn) {
  if(audioCtx.state === 'suspended') audioCtx.resume();
  stopMetronome(); if(btn) btn.classList.add('active');
  let delay = 600; if(speed > 0) delay = 1000 / (speed / 1.7 * 1.5);
  metroId = setInterval(() => {
    const o = audioCtx.createOscillator(); const g = audioCtx.createGain();
    o.connect(g); g.connect(audioCtx.destination); o.frequency.value = 800; g.gain.value = 0.1;
    o.start(); g.gain.exponentialRampToValueAtTime(0.00001, audioCtx.currentTime + 0.1); o.stop(audioCtx.currentTime + 0.1);
  }, delay);
}
function stopMetronome() { clearInterval(metroId); document.querySelectorAll('.metro-btn, .btn-action').forEach(b => b.classList.remove('active')); }
function tapBpm() {
  const now = Date.now(); if(lastTap) { const diff = (now - lastTap)/1000; const est = (1/diff)*1.1; document.getElementById('bpm-val').innerText = est.toFixed(1) + " m/s"; }
  lastTap = now; setTimeout(() => { if(Date.now()-lastTap > 2000) lastTap=0; }, 2000);
}
function runTimer(s) {
  if(audioCtx.state === 'suspended') audioCtx.resume();
  clearInterval(tInterval); let t = s;
  const tick = () => { let m = Math.floor(t/60).toString().padStart(2,'0'); let sec = (t%60).toString().padStart(2,'0'); document.getElementById('timer-disp').innerText = `${m}:${sec}`; };
  tick(); tInterval = setInterval(() => { t--; tick(); if(t<=0) { clearInterval(tInterval); document.getElementById('timer-disp').innerText = "PRET"; const o=audioCtx.createOscillator(); o.connect(audioCtx.destination); o.start(); o.stop(audioCtx.currentTime+0.5); } }, 1000);
}
function stopTimer() { clearInterval(tInterval); document.getElementById('timer-disp').innerText = "00:00"; }
function loadLocs(key) { const div = document.getElementById('loc-area'); if(!key) { div.innerHTML=''; return; } const data = LOCATIONS[key] || []; div.innerHTML = data.map(i => `<div style="padding:10px; border-bottom:1px solid #333"><b>${i.i} ${i.n}</b><br><span style="color:#94a3b8">${i.l}</span></div>`).join(''); }
function setSan(v) { state.san = v; document.getElementById('san-disp').innerText = v+"%"; saveState(); }
function saveState() { localStorage.setItem('phasmo_v21', JSON.stringify(state)); }
function loadState() { const s = localStorage.getItem('phasmo_v21'); if(s) state = JSON.parse(s); }
function resetAll() { if(confirm('Tout remettre √† z√©ro ?')) { localStorage.removeItem('phasmo_v21'); location.reload(); } }

init();
</script>
</body>
</html>
