
<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Journal Phasmophobia – Preuves & Fantômes</title>

  <style>
    :root{
      --bg:#0e1016; --paper:#121420; --ink:#e6e9ef; --muted:#9aa3b2; --accent:#5eead4;
      --line:#1a2235; --chip:#1b2131; --border:#20283a; --ok:#22c55e; --no:#ef4444;
    }
    body{margin:0; font-family:system-ui,Segoe UI,Roboto,Arial; background:#0e1016; color:var(--ink)}
    header{position:sticky; top:0; background:#121420; padding:12px 14px; border-bottom:1px solid var(--border); z-index:10}
    .wrap{max-width:1100px; margin:0 auto; padding:0 14px}
    .tabs{display:flex; gap:8px; flex-wrap:wrap}
    .tab{padding:8px 12px; border:1px solid var(--border); border-bottom:none; border-radius:10px 10px 0 0; background:#0d1120; color:#cfd6e6; text-decoration:none}
    .tab[data-active="true"]{background:#151a2a; color:#fff}

    main{padding:14px}
    .book{display:grid; grid-template-columns:1fr; gap:18px; background:#121420; border:1px solid var(--border); border-radius:14px; padding:18px}

    /* Preuves */
    .chips{display:flex; flex-wrap:wrap; gap:8px}
    .chip{display:flex; align-items:center; gap:8px; padding:8px 10px; background:var(--chip); border:1px solid var(--border); border-radius:999px}
    .chip .name{font-weight:600}
    .chip button{appearance:none; border:1px solid var(--border); background:#0e1322; color:#cfd6e6; padding:3px 7px; border-radius:7px; cursor:pointer; font-size:12px}
    .chip button[data-state="include"]{border-color:#1e3a2f; background:#0c1713; color:#a7f3d0}
    .chip button[data-state="exclude"]{border-color:#3a1e1e; background:#170c0c; color:#fecaca}

    section[hidden]{display:none !important}
    .count{color:var(--muted); font-size:13px}
    .hr{height:1px; background:linear-gradient(90deg,transparent,var(--line),transparent); margin:10px 0}

    /* Carte probables (Journal) */
    .card{border:1px solid var(--border); background:#0d1120; border-radius:12px; padding:12px}
    .card-title{font-weight:700; margin-bottom:8px}
    .mini-list{display:flex; flex-wrap:wrap; gap:8px}
    .mini-ghost{
      padding:6px 10px; border-radius:999px; background:#11162a; border:1px solid var(--border);
      font-size:12px; color:#cfe3ff
    }

    /* Fantômes */
    .toolbar{display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin-bottom:8px}
    .search{flex:1; min-width:220px}
    .search input{width:100%; padding:10px 12px; border-radius:10px; border:1px solid var(--border); background:#0d1120; color:#e6e9ef}

    .ghosts{display:grid; grid-template-columns:repeat(auto-fill,minmax(260px,1fr)); gap:12px}
    .ghost{
      border:1px solid var(--border); background:#0d1120; border-radius:12px; padding:12px;
      display:flex; flex-direction:column; gap:8px
    }
    .ghost.candidate{ outline:1px solid #1c3b2f; box-shadow:0 0 0 2px rgba(34,197,94,.15) inset }
    .name{font-weight:700}
    .badges{display:flex; flex-wrap:wrap; gap:6px}
    .badge{ padding:2px 8px; border-radius:999px; border:1px solid var(--border); background:#11162a; font-size:12px; color:#cfe3ff }
    .badge.ok{background:#0e1e17; color:#befae2; border-color:#1c3b2f}
    .badge.no{background:#1e0f0f; color:#fecaca; border-color:#3a1e1e}

    .tools{display:flex; gap:8px; flex-wrap:wrap}
    .btn{appearance:none; border:1px solid var(--border); background:#0e1322; color:#cfd6e6; padding:6px 10px; border-radius:8px; cursor:pointer; font-size:12px}
    .btn.primary{background:#15302b; border-color:#1c3b2f; color:#a7f3d0}

    .details{display:none; border-top:1px dashed #223; padding-top:8px; color:#cbd5e1; font-size:14px}
    .details.open{display:block}
    .tag{display:inline-block; padding:2px 6px; margin-right:6px; border:1px solid #2a354e; border-radius:6px; background:#0f1528; color:#a9b4cf; font-size:12px}
    .list{margin:6px 0 0 0; padding-left:16px}
    .list li{margin:2px 0}
    .src{font-size:12px; color:#9aa3b2}
    .src a{color:#9acbff; text-decoration:none}
  </style>
</head>

<body>

  <header>
    <div class="wrap">
      <nav class="tabs" role="tablist" aria-label="Sections du journal">
        <a class="tab" href="#journal"  id="tab-journal">Journal</a>
        <a class="tab" href="#fantomes" id="tab-fantomes">Fantômes</a>
        <a class="tab" href="#options"  id="tab-options">Options</a>
      </nav>
    </div>
  </header>

  <main class="wrap">
    <div class="book">

      <!-- JOURNAL -->
      <section id="journal" aria-labelledby="tab-journal">
        <h2>Preuves</h2>
        <p class="count" id="state-summary" aria-live="polite"></p>
        <div class="chips" id="proof-chips"></div>

        <div class="hr"></div>
        <div class="card" id="probables-card">
          <div class="card-title">Fantômes probables</div>
          <div class="mini-list" id="probables-box"></div>
        </div>
      </section>

      <!-- FANTÔMES -->
      <section id="fantomes" aria-labelledby="tab-fantomes" hidden>
        <div class="toolbar">
          <div class="search">
            <input type="search" id="ghost-search" placeholder="Rechercher un fantôme (nom, preuve)…" />
          </div>
          <div class="count" id="ghost-count"></div>
        </div>

        <div class="hr"></div>
        <div class="ghosts" id="ghost-list"></div>
      </section>

      <!-- OPTIONS -->
      <section id="options" aria-labelledby="tab-options" hidden>
        <button id="reset-all">Réinitialiser</button>
      </section>

    </div>
  </main>

<script>
/* ========= Preuves ========= */
const PROOFS = [
  { id:'emf',      label:'EMF Niveau 5' },
  { id:'orbe',     label:'Orbe' },
  { id:'spirit',   label:'Spirit Box' },
  { id:'freezing', label:'Températures glaciales' },
  { id:'uv',       label:'Traces UV' },
  { id:'dots',     label:'D.O.T.S' },
  { id:'writing',  label:'Écriture fantomatique' },
];

/* ========= Fantômes (27, v0.15.x) ========= */
const GHOSTS = [
  { name:'Esprit',        proofs:['emf','spirit','writing'] },
  { name:'Spectre',       proofs:['dots','emf','spirit'] },
  { name:'Fantôme',       proofs:['dots','uv','spirit'] },
  { name:'Poltergeist',   proofs:['uv','spirit','writing'] },
  { name:'Banshee',       proofs:['dots','orbe','uv'] },
  { name:'Djinn',         proofs:['emf','uv','freezing'] },
  { name:'Jument',        proofs:['orbe','spirit','writing'] },     // Mare
  { name:'Revenant',      proofs:['orbe','writing','freezing'] },
  { name:'Ombre',         proofs:['emf','writing','freezing'] },    // Shade
  { name:'Démon',         proofs:['writing','uv','freezing'] },
  { name:'Yurei',         proofs:['dots','orbe','freezing'] },
  { name:'Oni',           proofs:['dots','emf','freezing'] },
  { name:'Yokai',         proofs:['dots','orbe','spirit'] },
  { name:'Hantu',         proofs:['orbe','uv','freezing'] },
  { name:'Goryo',         proofs:['dots','emf','uv'] },
  { name:'Myling',        proofs:['writing','emf','uv'] },
  { name:'Onryo',         proofs:['orbe','freezing','spirit'] },
  { name:'Les Jumeaux',   proofs:['emf','freezing','spirit'] },
  { name:'Raiju',         proofs:['dots','emf','orbe'] },
  { name:'Obake',         proofs:['emf','orbe','uv'] },
  { name:'Le Mimic',      proofs:['spirit','uv','freezing'] },      // + orbes factices
  { name:'Moroi',         proofs:['spirit','writing','freezing'] },
  { name:'Deogen',        proofs:['dots','writing','spirit'] },
  { name:'Thaye',         proofs:['dots','orbe','writing'] },
  { name:'Dayan',         proofs:['emf','orbe','spirit'] },
  { name:'Gallu',         proofs:['emf','uv','spirit'] },
  { name:'Obambo',        proofs:['writing','uv','dots'] },
];

/* ========= Détails (résumés + sources) ========= */
const GHOST_INFO = {
  'Esprit': {
    desc:"Fantôme basique, passif, sans pouvoir distinct.",
    enBref:["Encens efficace 180s (au lieu de 90s).","Pas de comportement spécial hors chasse."],
    threshold:"50%", danger:"Aucun pouvoir", chaseTools:"—",
    src:"https://www.phasmophobia-fr.com/wiki-esprit-phasmophobiafr/"
  },
  'Yurei': {
    desc:"Vagabond, adore l’encens ; peut drainer la SAN via fermeture de porte.",
    enBref:["Encenser le bloque 90s dans sa pièce.","Porte qui se ferme + drain SAN (pouvoir spécifique)."],
    threshold:"50%", danger:"Faible", chaseTools:"—",
    src:"https://www.phasmophobia-fr.com/wiki-le-yurei-phasmophobiafr/"
  },
  'Démon': {
    desc:"Très agressif : chasse plus tôt et plus souvent.",
    enBref:["Peut chasser à très haute SAN.","Encens moins efficace ; crucifix plus efficace."],
    threshold:"(capacité) jusqu’à 100%", danger:"Élevé", chaseTools:"—",
    src:"https://www.phasmophobia-fr.com/wiki-le-demon-phasmophobiafr/"
  },
  'Raiju': {
    desc:"S’alimente des électroniques : plus tôt, plus vite.",
    enBref:["Chasse plus tôt si appareils actifs proches.","Vitesse accrue près d’appareils."],
    threshold:"≈65% (électroniques actives)", danger:"Moyen→Élevé", chaseTools:"Dangereux avec appareils",
    src:"https://www.phasmophobia-fr.com/wiki-raiju-phasmophobiafr/"
  },
  'Obake': {
    desc:"Métamorphe des empreintes.",
    enBref:["Empreintes spéciales (6 doigts…) et s’effacent vite.","Peut changer d’apparence en chasse."],
    threshold:"50%", danger:"Moyen", chaseTools:"—",
    src:"https://www.phasmophobia-fr.com/wiki-obake-phasmophobiafr/"
  },
  'Le Mimic': {
    desc:"Imite pouvoirs/comportements d’autres entités.",
    enBref:["Orbes ‘bonus’ toujours présents.","Copie un autre type toutes les 30–120s (hors chasse)."],
    threshold:"Variable", danger:"Variable", chaseTools:"Variable",
    src:"https://www.phasmophobia-fr.com/wiki-mimic-phasmophobiafr/"
  },
  'Les Jumeaux': {
    desc:"Double interactions ; vitesses de chasse différentes.",
    enBref:["Deux ‘sources’ apparentes d’interactions.","Vitesses différentes selon le ‘jumeau’ actif."],
    threshold:"50%", danger:"Moyen", chaseTools:"Moyen",
    src:"https://www.phasmophobia-fr.com/wiki-jumeaux-phasmophobiafr/"
  },
  'Dayan': {
    desc:"Plus rapide si un joueur proche se déplace ; lente si tout le monde est immobile.",
    enBref:["Exclusivement féminine.","Seuil/vitesse liés au mouvement à proximité."],
    threshold:"≈65% (proche d’un joueur en mouvement)", danger:"Moyen", chaseTools:"Élevé",
    src:"https://www.phasmophobia-fr.com/wiki-la-dayan-phasmophobiafr/"
  },
  'Gallu': {
    desc:"Trois états (Affaibli/Normal/Enragé) liés aux objets défensifs.",
    enBref:["Objets de défense l’enragent (efficacité réduite).","Fin de chasse enragé → repasse Affaibli."],
    threshold:"≈60% (selon état)", danger:"Moyen", chaseTools:"Variable",
    src:"https://www.phasmophobia-fr.com/wiki-gallu-phasmophobiafr/"
  },
  'Obambo': {
    desc:"Lunatique : alterne Calme ↔ Agressif (minutage).",
    enBref:["1re bascule à 1 min puis toutes les 2 min.","Agressif : plus tôt/plus vite mais moins longtemps."],
    threshold:"≈60% (état Agressif)", danger:"Faible→Moyen", chaseTools:"Variable",
    src:"https://www.phasmophobia-fr.com/wiki-obambo-phasmophobiafr/"
  },
};

/* ========= Persistance & onglets ========= */
const STORAGE_KEY = 'phasmo_journal_min_v1';
function loadState(){ try{ return JSON.parse(localStorage.getItem(STORAGE_KEY)) ?? { include:[], exclude:[], tab:'#journal' }; }catch{ return { include:[], exclude:[], tab:'#journal' }; } }
function saveState(s){ localStorage.setItem(STORAGE_KEY, JSON.stringify(s)); }
let state = loadState();

const tabs = [...document.querySelectorAll('.tab')];
const sections = { '#journal':journal, '#fantomes':fantomes, '#options':options };
function setActiveTab(hash){
  const h = sections[hash] ? hash : '#journal';
  Object.entries(sections).forEach(([k,el]) => el.hidden = (k !== h));
  tabs.forEach(a => a.dataset.active = (a.getAttribute('href') === h));
  state.tab = h; saveState(state);
  if (location.hash !== h) history.replaceState(null,'',h);
}
addEventListener('hashchange', () => setActiveTab(location.hash));
setActiveTab(state.tab || location.hash || '#journal');

/* ========= Preuves UI ========= */
const chipsRoot = document.getElementById('proof-chips');
const summaryEl = document.getElementById('state-summary');

function renderChips(){
  chipsRoot.innerHTML = '';
  PROOFS.forEach(p => {
    const wrap = document.createElement('div');
    wrap.className = 'chip';
    wrap.innerHTML = `
      <span class="name">${p.label}</span>
      <span>
        <button type="button" data-action="include" data-proof="${p.id}">Inclure</button>
        <button type="button" data-action="exclude" data-proof="${p.id}">Exclure</button>
        <button type="button" data-action="clear"   data-proof="${p.id}">Effacer</button>
      </span>
    `;
    const [bInc, bExc] = wrap.querySelectorAll('button');
    if (state.include.includes(p.id)) bInc.setAttribute('data-state','include');
    if (state.exclude.includes(p.id)) bExc.setAttribute('data-state','exclude');
    chipsRoot.appendChild(wrap);
  });
  updateSummary();
}
function updateSummary(){
  const inc = state.include.map(id => PROOFS.find(p=>p.id===id)?.label).filter(Boolean);
  const exc = state.exclude.map(id => PROOFS.find(p=>p.id===id)?.label).filter(Boolean);
  summaryEl.textContent = `Inclus: ${inc.length?inc.join(', '):'—'} | Exclus: ${exc.length?exc.join(', '):'—'}`;
}
chipsRoot.addEventListener('click', (e) => {
  const btn = e.target.closest('button'); if(!btn) return;
  const id = btn.dataset.proof, action = btn.dataset.action;
  state.include = state.include.filter(x => x !== id);
  state.exclude = state.exclude.filter(x => x !== id);
  if (action === 'include') state.include.push(id);
  if (action === 'exclude') state.exclude.push(id);
  // action 'clear' = rien à ajouter
  saveState(state);
  renderChips(); renderProbables(); renderGhostsAll();
});
document.getElementById('reset-all').addEventListener('click', () => {
  state.include = []; state.exclude = []; saveState(state);
  renderChips(); renderProbables(); renderGhostsAll();
});

/* ========= Logique & utilitaires ========= */
function ghostAllowed(ghost){
  const allIncluded = state.include.every(id => ghost.proofs.includes(id));
  const noneExcluded = state.exclude.every(id => !ghost.proofs.includes(id));
  return allIncluded && noneExcluded;
}
function labelOfProof(id){ return PROOFS.find(p=>p.id===id)?.label || id; }

/* ========= Journal : Probables ========= */
function renderProbables(){
  const box = document.getElementById('probables-box');
  const title = document.querySelector('#probables-card .card-title');
  const candidates = GHOSTS.filter(ghostAllowed).sort((a,b)=>a.name.localeCompare(b.name,'fr'));
  if (title) title.textContent = `Fantômes probables (${candidates.length})`;
  box.innerHTML = candidates.length
    ? candidates.map(g => `<span class="mini-ghost">${g.name}</span>`).join('')
    : `<span class="count">Aucun fantôme ne correspond.</span>`;
}

/* ========= Fantômes : liste complète + détails ========= */
function renderGhostsAll(){
  const list = document.getElementById('ghost-list');
  const count = document.getElementById('ghost-count');
  const q = (document.getElementById('ghost-search')?.value || '').trim().toLowerCase();

  const ghosts = GHOSTS
    .slice()
    .map(g => ({ ...g, candidate: ghostAllowed(g) }))
    .sort((a,b) => (b.candidate - a.candidate) || a.name.localeCompare(b.name,'fr'))
    .filter(g => {
      if (!q) return true;
      const labels = g.proofs.map(labelOfProof).map(s => s.toLowerCase());
      return g.name.toLowerCase().includes(q) || labels.some(l => l.includes(q));
    });

  list.innerHTML = ghosts.map(g => {
    const badges = g.proofs.map(id => {
      const inInc = state.include.includes(id);
      const inExc = state.exclude.includes(id);
      const cls = inInc ? 'badge ok' : inExc ? 'badge no' : 'badge';
      return `<span class="${cls}">${labelOfProof(id)}</span>`;
    }).join('');

    const info = GHOST_INFO[g.name];
    const details = info ? `
      <div class="details" id="det-${g.name}">
        <div>
          <span class="tag">Seuil</span> ${info.threshold || '—'}
          <span class="tag">Danger</span> ${info.danger || '—'}
          <span class="tag">Poursuite</span> ${info.chaseTools || '—'}
        </div>
        <div style="margin-top:6px">${info.desc || ''}</div>
        ${info.enBref?.length ? `<ul class="list">${info.enBref.map(x=>`<li>${x}</li>`).join('')}</ul>` : ''}
        ${info.src ? `<div class="src" style="margin-top:6px">Source : <a href="${info.src}" target="_blank" rel="noopener">Phasmophobia‑FR</a></div>` : ''}
      </div>` : `
      <div class="details" id="det-${g.name}">
        <div class="src">Pour la fiche complète, consulte la page FR.</div>
      </div>`;

    return `
      <div class="ghost${g.candidate ? ' candidate' : ''}">
        <div class="name">${g.name}${g.candidate ? ' • <span style="color:#22c55e">candidat</span>' : ''}</div>
        <div class="badges">${badges}</div>
        <div class="tools">
          <button class="btn primary" data-act="toggle" data-target="det-${g.name}">Voir détails</button>
        </div>
        ${details}
      </div>`;
  }).join('');

  if (count) count.textContent = `${ghosts.length} fantôme${ghosts.length>1?'s':''}`;
}
document.getElementById('ghost-search')?.addEventListener('input', renderGhostsAll);
document.getElementById('ghost-list')?.addEventListener('click', (e) => {
  const btn = e.target.closest('button[data-act="toggle"]'); if(!btn) return;
  const id = btn.dataset.target; const box = document.getElementById(id);
  if (!box) return; box.classList.toggle('open');
  btn.textContent = box.classList.contains('open') ? 'Masquer détails' : 'Voir détails';
});

/* ========= Initial render ========= */
renderChips();
renderProbables();
renderGhostsAll();
</script>

</body>
</html>
