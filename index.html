<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PHASMO-TRACKER v3.9 | Chrono Fix</title>
  <style>
    :root {
      --bg: #0b0e14; --card-bg: #161b26; --header-bg: rgba(22, 27, 38, 0.95);
      --accent: #5eead4; --text: #e2e8f0; --muted: #94a3b8; --border: #2d3748;
      --danger: #f87171; --success: #34d399; --warning: #fbbf24;
    }
    body { margin: 0; font-family: 'Segoe UI', system-ui, sans-serif; background: var(--bg); color: var(--text); }
    
    header { 
      position: sticky; top: 0; background: var(--header-bg); backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--border); padding: 1rem; z-index: 1000;
      display: flex; justify-content: space-between; align-items: center;
    }

    .dashboard { display: flex; max-width: 1400px; margin: 20px auto; gap: 20px; padding: 0 20px; align-items: flex-start; }
    
    aside { width: 320px; position: sticky; top: 100px; flex-shrink: 0; display: flex; flex-direction: column; gap: 15px; }
    .card { background: var(--card-bg); border: 1px solid var(--border); border-radius: 12px; padding: 1.2rem; }
    
    /* Timer Style */
    .timer-display { font-family: monospace; font-size: 2.2rem; text-align: center; color: var(--warning); margin: 10px 0; background: #0b0e14; border-radius: 8px; padding: 10px; border: 1px solid var(--border); }
    .timer-btns { display: flex; gap: 5px; margin-bottom: 10px; }
    .timer-btn { flex: 1; padding: 10px 5px; border: 1px solid var(--border); border-radius: 4px; cursor: pointer; font-weight: bold; background: #1e2533; color: white; transition: 0.2s; }
    .timer-btn.running { background: var(--warning); color: black; border-color: white; }
    
    .guide-box { font-size: 0.75rem; color: var(--muted); border-top: 1px solid var(--border); padding-top: 10px; line-height: 1.4; }
    .guide-box b { color: var(--accent); }

    /* Sant√© Mentale */
    .san-display { font-size: 1.5rem; font-weight: 900; color: var(--accent); text-align: center; margin: 10px 0; }
    input[type=range] { width: 100%; cursor: pointer; accent-color: var(--accent); }

    /* Preuves */
    .proof-item { padding: 8px 0; border-bottom: 1px solid #232a37; }
    .btn-group { display: flex; gap: 4px; margin-top: 5px; }
    .btn-action { flex: 1; border: 1px solid var(--border); background: #1e2533; color: var(--muted); padding: 6px; border-radius: 4px; cursor: pointer; font-size: 10px; font-weight: bold; }
    .btn-action[data-state="include"] { background: var(--success); color: #000; }
    .btn-action[data-state="exclude"] { background: var(--danger); color: #fff; }

    /* Grille */
    .ghost-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(340px, 1fr)); gap: 15px; flex-grow: 1; }
    .ghost-card { background: var(--card-bg); border: 1px solid var(--border); border-radius: 12px; padding: 1.2rem; transition: 0.3s; opacity: 0.35; filter: grayscale(1); }
    .ghost-card.candidate { opacity: 1; filter: none; border-color: var(--accent); box-shadow: 0 4px 15px rgba(0,0,0,0.5); }
    .ghost-card.can-hunt { border-left: 4px solid var(--danger); }

    .ghost-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
    .ghost-name { font-size: 1.2rem; font-weight: 800; }
    .hunt-tag { font-size: 0.7rem; color: var(--danger); font-weight: bold; }
    
    .badge-list { display: flex; flex-wrap: wrap; gap: 5px; margin-bottom: 12px; }
    .badge { font-size: 0.7rem; padding: 3px 8px; background: #0b0e14; border-radius: 4px; border: 1px solid var(--border); }
    .badge.ok { color: var(--success); border-color: var(--success); }
    
    .secrets-btn { width: 100%; padding: 8px; background: #2d3748; border: none; color: white; border-radius: 6px; cursor: pointer; font-size: 0.8rem; }
    .secrets-content { margin-top: 10px; padding: 10px; background: rgba(0,0,0,0.2); border-left: 3px solid var(--accent); font-size: 0.85rem; display: none; }
    .secrets-content.open { display: block; }

    @media (max-width: 900px) { .dashboard { flex-direction: column; } aside { width: 100%; position: relative; top: 0; } }
  </style>
</head>
<body>

<header>
  <div style="font-weight:900; color:var(--accent)">PHASMO-TRACKER <span style="font-weight:300">v3.9</span></div>
  <button onclick="resetAll()" style="background:var(--danger); border:none; color:white; padding:8px 15px; border-radius:6px; cursor:pointer; font-weight:bold">RESET MISSION</button>
</header>

<main class="dashboard">
  <aside>
    <div class="card">
      <h2 style="font-size:0.8rem; color:var(--warning)">üí® CHRONO ENCENS</h2>
      <div class="timer-display" id="timer-val">00:00</div>
      <div class="timer-btns">
        <button id="btn-90" class="timer-btn" onclick="handleTimer(90, this)">90s</button>
        <button id="btn-180" class="timer-btn" onclick="handleTimer(180, this)">180s (Esprit)</button>
        <button class="timer-btn" style="background:#451a1a; flex:0.4" onclick="stopTimer()">X</button>
      </div>
      
      <div class="guide-box">
        <b>Guide Expert :</b><br>
        1. <b>Test Esprit :</b> Lance 180s. S'il chasse avant la fin, √©limine l'Esprit.<br>
        2. <b>Test D√©mon :</b> S'il chasse avant 60s, c'est un D√©mon.<br>
        3. <b>S√©curit√© :</b> L'encens prot√®ge 90s (sauf D√©mon/Esprit).
      </div>
    </div>

    <div class="card">
      <h2>Sant√© Mentale üß†</h2>
      <div class="san-display" id="san-val">100%</div>
      <input type="range" id="san-slider" min="0" max="100" value="100" oninput="updateSan(this.value)">
    </div>

    <div class="card">
      <h2>Preuves üîé</h2>
      <div id="proof-list"></div>
    </div>
  </aside>

  <div class="ghost-grid" id="ghost-display"></div>
</main>

<script>
/* Donn√©es identiques */
const PROOFS = [
  { id:'emf', label:'üì∂ EMF Niveau 5' }, { id:'orbe', label:'üîÆ Orbe' },
  { id:'spirit', label:'üìª Spirit Box' }, { id:'freezing', label:'‚ùÑÔ∏è Temp. Glaciales' },
  { id:'uv', label:'üë£ Traces UV' }, { id:'dots', label:'üü¢ D.O.T.S' }, { id:'writing', label:'üìñ √âcriture' }
];

const GHOST_DATA = [
  { name:'Esprit', proofs:['emf','spirit','writing'], threshold: 50, speed:"1.7 m/s", test:"Encens : Inactif pendant 180s (au lieu de 90s)." },
  { name:'Spectre', proofs:['dots','emf','spirit'], threshold: 50, speed:"1.7 m/s", test:"Sel : Ne marche jamais dedans. Peut se TP (EMF 2)." },
  { name:'Fant√¥me', proofs:['dots','uv','spirit'], threshold: 50, speed:"1.7 m/s", test:"Photo : Dispara√Æt si pris en photo. Clignote lentement." },
  { name:'Poltergeist', proofs:['uv','spirit','writing'], threshold: 50, speed:"1.7 m/s", test:"Lancer : Peut jeter plusieurs objets d'un coup." },
  { name:'Banshee', proofs:['dots','orbe','uv'], threshold: 50, speed:"1.7 m/s", test:"Cri unique au micro parabolique. Cible un seul joueur." },
  { name:'Djinn', proofs:['emf','uv','freezing'], threshold: 50, speed:"1.7-2.5m/s", test:"Courant : Ne le coupe jamais. Acc√©l√®re si courant ON." },
  { name:'Jument', proofs:['orbe','spirit','writing'], threshold: 60, speed:"1.7 m/s", test:"Lumi√®re : Chasse √† 60% (Noir) ou 40% (Allum√©)." },
  { name:'Revenant', proofs:['orbe','writing','freezing'], threshold: 50, speed:"1.1-3.0m/s", test:"Ligne de vue : Lent si cach√©, sprinte s'il vous voit." },
  { name:'Ombre', proofs:['emf','writing','freezing'], threshold: 35, speed:"1.7 m/s", test:"Timide : Ne chasse pas si vous √™tes group√©s." },
  { name:'D√©mon', proofs:['writing','uv','freezing'], threshold: 70, speed:"1.7 m/s", test:"Crucifix : Port√©e 5m. Peut chasser apr√®s 60s d'encens." },
  { name:'Yurei', proofs:['dots','orbe','freezing'], threshold: 50, speed:"1.7 m/s", test:"Porte : Claque les portes (drain de 15% SAN)." },
  { name:'Oni', proofs:['dots','emf','freezing'], threshold: 50, speed:"1.7 m/s", test:"Visibilit√© : Clignote peu en chasse. Tr√®s actif." },
  { name:'Yokai', proofs:['dots','orbe','spirit'], threshold: 80, speed:"1.7 m/s", test:"Voix : Chasse t√¥t si vous parlez. Sourd √† +2m." },
  { name:'Hantu', proofs:['orbe','uv','freezing'], threshold: 50, speed:"1.4-2.7m/s", test:"Froid : Rapide dans le froid. Pas d'acc√©l√©ration ligne de vue." },
  { name:'Goryo', proofs:['dots','emf','uv'], threshold: 50, speed:"1.7 m/s", test:"D.O.T.S : Uniquement sur cam√©ra." },
  { name:'Myling', proofs:['writing','emf','uv'], threshold: 50, speed:"1.7 m/s", test:"Pas : Silencieux si la lampe ne clignote pas." },
  { name:'Onryo', proofs:['orbe','freezing','spirit'], threshold: 60, speed:"1.7 m/s", test:"Bougie : √âteindre 3 bougies = Chasse forc√©e." },
  { name:'Les Jumeaux', proofs:['emf','freezing','spirit'], threshold: 50, speed:"1.5-1.9m/s", test:"Double interaction : Courbe EMF bizarre." },
  { name:'Raiju', proofs:['dots','emf','orbe'], threshold: 65, speed:"1.7-2.5m/s", test:"√âlectronique : Acc√©l√®re pr√®s des objets au sol." },
  { name:'Obake', proofs:['emf','orbe','uv'], threshold: 50, speed:"1.7 m/s", test:"6 Doigts : Chance d'empreinte unique." },
  { name:'Le Mimic', proofs:['spirit','uv','freezing'], threshold: 50, speed:"Variable", test:"4√®me Preuve : Toujours des Orbes (Factice)." },
  { name:'Moroi', proofs:['spirit','writing','freezing'], threshold: 50, speed:"1.5-2.2m/s", test:"Vitesse proportionnelle √† votre perte de SAN." },
  { name:'Deogen', proofs:['dots','writing','spirit'], threshold: 40, speed:"3.0-0.4m/s", test:"Incontournable : Sait o√π vous √™tes. Ralentit proche de vous." },
  { name:'Thaye', proofs:['dots','orbe','writing'], threshold: 75, speed:"2.7-1.0m/s", test:"Vieillit : Ralentit avec le temps." }
];

let state = { include: [], exclude: [], san: 100 };
let timeLeft = 0;
let timerId = null;

// Logique du Chrono Corrig√©e
function handleTimer(secs, btn) {
  stopTimer();
  timeLeft = secs;
  btn.classList.add('running');
  
  timerId = setInterval(() => {
    timeLeft--;
    updateTimerDisplay();
    
    if (timeLeft <= 0) {
      stopTimer();
      document.getElementById('timer-val').textContent = "PR√äT !";
    }
  }, 1000);
  updateTimerDisplay();
}

function updateTimerDisplay() {
  const m = Math.floor(timeLeft / 60);
  const s = timeLeft % 60;
  document.getElementById('timer-val').textContent = 
    `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
}

function stopTimer() {
  clearInterval(timerId);
  timeLeft = 0;
  document.getElementById('timer-val').textContent = "00:00";
  document.querySelectorAll('.timer-btn').forEach(b => b.classList.remove('running'));
}

/* Fonctions de Rendu */
function updateSan(v) { 
    state.san = v; 
    document.getElementById('san-val').textContent = v + "%";
    render(); 
}

function render() {
  document.getElementById('proof-list').innerHTML = PROOFS.map(p => {
    const isInc = state.include.includes(p.id);
    const isExc = state.exclude.includes(p.id);
    return `<div class="proof-item"><span style="font-size:0.85rem;font-weight:600">${p.label}</span><div class="btn-group">
      <button class="btn-action" data-state="${isInc?'include':''}" onclick="toggleProof('${p.id}','include')">OUI</button>
      <button class="btn-action" data-state="${isExc?'exclude':''}" onclick="toggleProof('${p.id}','exclude')">NON</button>
      <button class="btn-action" onclick="toggleProof('${p.id}','clear')">CLR</button>
    </div></div>`;
  }).join('');

  document.getElementById('ghost-display').innerHTML = GHOST_DATA.map(g => {
    let gp = [...g.proofs]; if(g.name === 'Le Mimic') gp.push('orbe');
    const isCandidate = state.include.every(id => gp.includes(id)) && state.exclude.every(id => !gp.includes(id));
    const canHunt = state.san <= g.threshold;
    
    return `
      <div class="ghost-card ${isCandidate ? 'candidate' : ''} ${canHunt && isCandidate ? 'can-hunt' : ''}">
        <div class="ghost-header">
          <div class="ghost-name">${g.name}</div>
          <div class="hunt-tag">${canHunt ? '‚ö†Ô∏è CHASSE' : ''}</div>
        </div>
        <div style="font-size:0.7rem; color:var(--warning); margin-bottom:8px">Seuil : ${g.threshold}% | Vitesse : ${g.speed}</div>
        <div class="badge-list">
          ${g.proofs.map(pID => `<span class="badge ${state.include.includes(pID)?'ok':''}">${PROOFS.find(x=>x.id===pID).label}</span>`).join('')}
        </div>
        <button class="secrets-btn" onclick="this.nextElementSibling.classList.toggle('open')">TEST EXPERT ‚ñº</button>
        <div class="secrets-content">${g.test}</div>
      </div>
    `;
  }).join('');
}

function toggleProof(id, action) {
  state.include = state.include.filter(x => x !== id);
  state.exclude = state.exclude.filter(x => x !== id);
  if (action === 'include') state.include.push(id);
  if (action === 'exclude') state.exclude.push(id);
  render();
}

function resetAll() { 
    state = { include: [], exclude: [], san: 100 }; 
    document.getElementById('san-slider').value = 100; 
    stopTimer();
    updateSan(100); 
}
render();
</script>
</body>
</html>
