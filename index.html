<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PHASMO-TRACKER v4.2 | Expert, Chrono & Cartes</title>
  <style>
    :root {
      --bg: #0b0e14; --card-bg: #161b26; --header-bg: rgba(22, 27, 38, 0.95);
      --accent: #5eead4; --text: #e2e8f0; --muted: #94a3b8; --border: #2d3748;
      --danger: #f87171; --success: #34d399; --warning: #fbbf24;
    }
    body { margin: 0; font-family: 'Segoe UI', system-ui, sans-serif; background: var(--bg); color: var(--text); }
    
    header { 
      position: sticky; top: 0; background: var(--header-bg); backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--border); padding: 0.8rem 1.5rem; z-index: 1000;
      display: flex; justify-content: space-between; align-items: center;
    }

    .nav-tabs { display: flex; gap: 15px; background: #0b0e14; padding: 5px; border-radius: 8px; border: 1px solid var(--border); }
    .nav-btn { background: none; border: none; color: var(--muted); cursor: pointer; font-weight: bold; padding: 8px 15px; border-radius: 6px; transition: 0.3s; }
    .nav-btn.active { color: #000; background: var(--accent); }

    .dashboard { display: flex; max-width: 1400px; margin: 20px auto; gap: 20px; padding: 0 20px; align-items: flex-start; }
    
    /* Tracker Layout */
    aside { width: 320px; position: sticky; top: 100px; flex-shrink: 0; display: flex; flex-direction: column; gap: 15px; }
    .card { background: var(--card-bg); border: 1px solid var(--border); border-radius: 12px; padding: 1.2rem; }
    
    /* Timer */
    .timer-display { font-family: monospace; font-size: 2.2rem; text-align: center; color: var(--warning); margin: 10px 0; background: #0b0e14; border-radius: 8px; padding: 10px; border: 1px solid var(--border); }
    .timer-btns { display: flex; gap: 5px; }
    .timer-btn { flex: 1; padding: 10px 5px; border: 1px solid var(--border); border-radius: 4px; cursor: pointer; font-weight: bold; background: #1e2533; color: white; }
    .timer-btn.running { background: var(--warning); color: black; border-color: white; }

    /* Grille Fant√¥mes */
    #page-tracker { display: flex; gap: 20px; width: 100%; }
    .ghost-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(340px, 1fr)); gap: 15px; flex-grow: 1; }
    .ghost-card { background: var(--card-bg); border: 1px solid var(--border); border-radius: 12px; padding: 1.2rem; transition: 0.3s; opacity: 0.35; filter: grayscale(1); }
    .ghost-card.candidate { opacity: 1; filter: none; border-color: var(--accent); box-shadow: 0 4px 15px rgba(0,0,0,0.5); }
    .ghost-card.can-hunt { border-left: 5px solid var(--danger); }

    /* Page Cartes */
    #page-maps { display: none; width: 100%; flex-direction: column; gap: 20px; }
    .map-select { width: 100%; padding: 12px; background: var(--card-bg); color: white; border: 1px solid var(--border); border-radius: 8px; font-size: 1rem; }
    .map-viewer { width: 100%; min-height: 700px; background: #000; border-radius: 12px; display: flex; align-items: flex-start; justify-content: center; overflow: auto; border: 1px solid var(--border); padding: 10px; }
    .map-viewer img { max-width: 100%; border-radius: 4px; }

    .badge { font-size: 0.7rem; padding: 3px 8px; background: #0b0e14; border-radius: 4px; border: 1px solid var(--border); margin-right: 5px; margin-bottom: 5px; display: inline-block; }
    .badge.ok { color: var(--success); border-color: var(--success); }
    .secrets-btn { width: 100%; padding: 8px; background: #2d3748; border: none; color: white; border-radius: 6px; cursor: pointer; margin-top: 10px; font-weight: bold; }
    .secrets-content { margin-top: 10px; padding: 10px; background: rgba(0,0,0,0.2); border-left: 3px solid var(--accent); font-size: 0.85rem; display: none; }
    .secrets-content.open { display: block; }
    
    @media (max-width: 900px) { .dashboard { flex-direction: column; } aside { width: 100%; position: relative; top: 0; } }
  </style>
</head>
<body>

<header>
  <div style="font-weight:900; color:var(--accent); font-size: 1.2rem;">PHASMO-TRACKER</div>
  
  <nav class="nav-tabs">
    <button id="nav-tracker" class="nav-btn active" onclick="switchPage('tracker')">JOURNAL</button>
    <button id="nav-maps" class="nav-btn" onclick="switchPage('maps')">CARTES</button>
  </nav>

  <button onclick="resetAll()" style="background:var(--danger); border:none; color:white; padding:8px 15px; border-radius:6px; cursor:pointer; font-weight:bold">RESET</button>
</header>

<main class="dashboard">
  <div id="page-tracker">
    <aside>
      <div class="card">
        <h2 style="font-size:0.8rem; color:var(--warning); margin:0 0 10px 0;">üí® CHRONO ENCENS</h2>
        <div class="timer-display" id="timer-val">00:00</div>
        <div class="timer-btns">
          <button class="timer-btn" onclick="handleTimer(90, this)">90s</button>
          <button class="timer-btn" onclick="handleTimer(180, this)">180s (Esprit)</button>
          <button class="timer-btn" style="background:#451a1a; flex:0.4" onclick="stopTimer()">X</button>
        </div>
      </div>
      
      <div class="card">
        <h2 style="font-size:0.8rem; color:var(--accent); margin:0 0 10px 0;">SANT√â MENTALE üß†</h2>
        <div style="text-align:center; font-size:1.8rem; color:var(--accent); font-weight:900" id="san-val">100%</div>
        <input type="range" id="san-slider" min="0" max="100" value="100" oninput="updateSan(this.value)">
      </div>

      <div class="card">
        <h2 style="font-size:0.8rem; color:var(--muted); margin:0 0 10px 0;">PREUVES üîé</h2>
        <div id="proof-list"></div>
      </div>
    </aside>

    <div class="ghost-grid" id="ghost-display"></div>
  </div>

  <div id="page-maps">
    <div class="card">
      <h2 style="margin:0 0 10px 0;">Emplacement des Objets Maudits üó∫Ô∏è</h2>
      <select class="map-select" onchange="loadMap(this.value)">
        <option value="">-- S√©lectionner une carte --</option>
        <option value="Tanglewood">6 Tanglewood Drive</option>
        <option value="Edgefield">42 Edgefield Road</option>
        <option value="Ridgeview">10 Ridgeview Court</option>
        <option value="Grafton">Grafton Farmhouse</option>
        <option value="Willow">Willow Street</option>
        <option value="Bleasdale">Bleasdale Farmhouse</option>
        <option value="Woodwind">Camp Woodwind</option>
        <option value="Prison">Prison</option>
        <option value="SunnyMeadows">Sunny Meadows</option>
      </select>
    </div>
    <div class="map-viewer" id="map-container">
      <div style="color:var(--muted); text-align:center;">
        <p>S√©lectionnez une carte pour afficher le plan technique.</p>
        <p style="font-size:0.8rem;">(Les points color√©s indiquent les objets maudits)</p>
      </div>
    </div>
  </div>
</main>

<script>
/* --- LOGIQUE CHRONO --- */
let timeLeft = 0;
let timerId = null;

function handleTimer(secs, btn) {
  stopTimer();
  timeLeft = secs;
  btn.classList.add('running');
  updateTimerDisplay(); // Imm√©diat
  
  timerId = setInterval(() => {
    timeLeft--;
    updateTimerDisplay();
    if (timeLeft <= 0) {
      stopTimer();
      document.getElementById('timer-val').textContent = "PR√äT !";
      const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      const osc = audioCtx.createOscillator();
      osc.connect(audioCtx.destination);
      osc.start(); osc.stop(audioCtx.currentTime + 0.2);
    }
  }, 1000);
}

function updateTimerDisplay() {
  const m = Math.floor(timeLeft / 60);
  const s = timeLeft % 60;
  document.getElementById('timer-val').textContent = `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
}

function stopTimer() {
  clearInterval(timerId);
  document.querySelectorAll('.timer-btn').forEach(b => b.classList.remove('running'));
  document.getElementById('timer-val').textContent = "00:00";
}

/* --- LOGIQUE NAVIGATION & MAPS --- */
function switchPage(page) {
  document.getElementById('page-tracker').style.display = (page === 'tracker' ? 'flex' : 'none');
  document.getElementById('page-maps').style.display = (page === 'maps' ? 'flex' : 'none');
  document.getElementById('nav-tracker').classList.toggle('active', page === 'tracker');
  document.getElementById('nav-maps').classList.toggle('active', page === 'maps');
}

function loadMap(mapName) {
  const container = document.getElementById('map-container');
  if(!mapName) return;
  // Utilisation des cartes HD avec emplacements maudits
  const baseUrl = "https://www.phasmophobia-fr.com/wp-content/uploads/2022/maps/";
  const maps = {
    'Tanglewood': 'https://static.wikia.nocookie.net/phasmophobia/images/1/1d/Tanglewood_Drive_Map.png',
    'Willow': 'https://static.wikia.nocookie.net/phasmophobia/images/4/4b/Willow_Street_House_Map.png',
    'Edgefield': 'https://static.wikia.nocookie.net/phasmophobia/images/0/01/42_Edgefield_Road_Map.png',
    'Ridgeview': 'https://static.wikia.nocookie.net/phasmophobia/images/7/77/10_Ridgeview_Court_Map.png',
    'Grafton': 'https://static.wikia.nocookie.net/phasmophobia/images/d/df/Grafton_Farmhouse_Map.png',
    'Woodwind': 'https://static.wikia.nocookie.net/phasmophobia/images/d/df/Camp_Woodwind_Map.png'
  };
  container.innerHTML = `<img src="${maps[mapName] || 'https://via.placeholder.com/800x600?text=Carte+non+disponible'}" alt="Carte de ${mapName}">`;
}

/* --- LOGIQUE FANT√îMES --- */
const PROOFS = [
  { id:'emf', label:'üì∂ EMF Niveau 5' }, { id:'orbe', label:'üîÆ Orbe' },
  { id:'spirit', label:'üìª Spirit Box' }, { id:'freezing', label:'‚ùÑÔ∏è Temp. Glaciales' },
  { id:'uv', label:'üë£ Traces UV' }, { id:'dots', label:'üü¢ D.O.T.S' }, { id:'writing', label:'üìñ √âcriture' }
];

const GHOST_DATA = [
  { name:'Esprit', proofs:['emf','spirit','writing'], threshold: 50, speed:"1.7 m/s", test:"Encens : Bloque les chasses 180s." },
  { name:'Spectre', proofs:['dots','emf','spirit'], threshold: 50, speed:"1.7 m/s", test:"Sel : Ne marche jamais dedans." },
  { name:'Fant√¥me', proofs:['dots','uv','spirit'], threshold: 50, speed:"1.7 m/s", test:"Clignote tr√®s lentement en chasse." },
  { name:'Poltergeist', proofs:['uv','spirit','writing'], threshold: 50, speed:"1.7 m/s", test:"Explosion : Jette plusieurs objets d'un coup." },
  { name:'Banshee', proofs:['dots','orbe','uv'], threshold: 50, speed:"1.7 m/s", test:"Cri unique au micro parabolique." },
  { name:'Djinn', proofs:['emf','uv','freezing'], threshold: 50, speed:"1.7-2.5m/s", test:"Ne coupe jamais le courant lui-m√™me." },
  { name:'Jument', proofs:['orbe','spirit','writing'], threshold: 60, speed:"1.7 m/s", test:"Pr√©f√®re le noir. √âteint les lampes." },
  { name:'Revenant', proofs:['orbe','writing','freezing'], threshold: 50, speed:"1.1-3.0m/s", test:"Lent si cach√©, missile s'il vous voit." },
  { name:'Ombre', proofs:['emf','writing','freezing'], threshold: 35, speed:"1.7 m/s", test:"Tr√®s timide. Ne chasse pas si group√©s." },
  { name:'D√©mon', proofs:['writing','uv','freezing'], threshold: 70, speed:"1.7 m/s", test:"Chasse tr√®s agressive (60s apr√®s encens)." },
  { name:'Yurei', proofs:['dots','orbe','freezing'], threshold: 50, speed:"1.7 m/s", test:"Claque les portes de loin (drain SAN)." },
  { name:'Oni', proofs:['dots','emf','freezing'], threshold: 50, speed:"1.7 m/s", test:"Tr√®s visible en chasse (clignote peu)." },
  { name:'Yokai', proofs:['dots','orbe','spirit'], threshold: 80, speed:"1.7 m/s", test:"Ne vous entend pas √† plus de 2m." },
  { name:'Hantu', proofs:['orbe','uv','freezing'], threshold: 50, speed:"1.4-2.7m/s", test:"Rapide dans le froid (bu√©e buccale)." },
  { name:'Goryo', proofs:['dots','emf','uv'], threshold: 50, speed:"1.7 m/s", test:"DOTS uniquement via cam√©ra." },
  { name:'Myling', proofs:['writing','emf','uv'], threshold: 50, speed:"1.7 m/s", test:"Pas inaudibles √† longue distance." },
  { name:'Onryo', proofs:['orbe','freezing','spirit'], threshold: 60, speed:"1.7 m/s", test:"√âteindre une bougie = Risque de chasse." },
  { name:'Les Jumeaux', proofs:['emf','freezing','spirit'], threshold: 50, speed:"1.5-1.9m/s", test:"Vitesse change selon le jumeau actif." },
  { name:'Raiju', proofs:['dots','emf','orbe'], threshold: 65, speed:"1.7-2.5m/s", test:"Boost√© par les objets √©lectroniques." },
  { name:'Obake', proofs:['emf','orbe','uv'], threshold: 50, speed:"1.7 m/s", test:"Empreintes √† 6 doigts uniques." },
  { name:'Le Mimic', proofs:['spirit','uv','freezing'], threshold: 50, speed:"Variable", test:"Orbes toujours pr√©sents (4e preuve)." },
  { name:'Moroi', proofs:['spirit','writing','freezing'], threshold: 50, speed:"1.5-2.2m/s", test:"Plus fou vous √™tes, plus il va vite." },
  { name:'Deogen', proofs:['dots','writing','spirit'], threshold: 40, speed:"3.0-0.4m/s", test:"Sait o√π vous √™tes. Ralentit proche." },
  { name:'Thaye', proofs:['dots','orbe','writing'], threshold: 75, speed:"2.7-1.0m/s", test:"Vieillit : Ralentit avec le temps." }
];

let state = { include: [], exclude: [], san: 100 };

function updateSan(v) { 
  state.san = v; document.getElementById('san-val').textContent = v + "%"; render(); 
}

function render() {
  document.getElementById('proof-list').innerHTML = PROOFS.map(p => {
    const isInc = state.include.includes(p.id);
    const isExc = state.exclude.includes(p.id);
    return `<div class="proof-item"><span style="font-size:0.85rem;font-weight:600">${p.label}</span><div class="btn-group">
      <button class="btn-action" data-state="${isInc?'include':''}" onclick="toggleProof('${p.id}','include')">OUI</button>
      <button class="btn-action" data-state="${isExc?'exclude':''}" onclick="toggleProof('${p.id}','exclude')">NON</button>
      <button class="btn-action" onclick="toggleProof('${p.id}','clear')">CLR</button>
    </div></div>`;
  }).join('');

  document.getElementById('ghost-display').innerHTML = GHOST_DATA.map(g => {
    let gp = [...g.proofs]; if(g.name === 'Le Mimic') gp.push('orbe');
    const isCandidate = state.include.every(id => gp.includes(id)) && state.exclude.every(id => !gp.includes(id));
    const canHunt = state.san <= g.threshold;
    
    return `
      <div class="ghost-card ${isCandidate ? 'candidate' : ''} ${canHunt && isCandidate ? 'can-hunt' : ''}">
        <div class="ghost-header"><div class="ghost-name">${g.name}</div><div class="hunt-tag">${canHunt ? '‚ö†Ô∏è CHASSE' : ''}</div></div>
        <div style="font-size:0.7rem; color:var(--warning); margin-bottom:8px">Seuil : ${g.threshold}% | Vitesse : ${g.speed}</div>
        <div class="badge-list">${g.proofs.map(pID => `<span class="badge ${state.include.includes(pID)?'ok':''}">${PROOFS.find(x=>x.id===pID).label}</span>`).join('')}</div>
        <button class="secrets-btn" onclick="this.nextElementSibling.classList.toggle('open')">TEST EXPERT ‚ñº</button>
        <div class="secrets-content">${g.test}</div>
      </div>`;
  }).join('');
}

function toggleProof(id, action) {
  state.include = state.include.filter(x => x !== id); state.exclude = state.exclude.filter(x => x !== id);
  if (action === 'include') state.include.push(id); if (action === 'exclude') state.exclude.push(id);
  render();
}

function resetAll() { state = { include: [], exclude: [], san: 100 }; document.getElementById('san-slider').value = 100; updateSan(100); stopTimer(); }
render();
</script>
</body>
</html>
