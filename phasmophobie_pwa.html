
<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>PWA Diag Court</title>
  <meta name="theme-color" content="#0e1016">
  <style>
    body{margin:0;font-family:system-ui,Segoe UI,Roboto,Arial;background:#0e1016;color:#e6e9ef}
    .wrap{max-width:900px;margin:0 auto;padding:18px}
    .banner{background:#0d1322;border:1px solid #20283a;border-radius:12px;padding:12px;margin:12px 0}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .ev{display:inline-flex;align-items:center;gap:8px;padding:10px 12px;border-radius:10px;background:#111827;
        border:1px solid #1f2937;cursor:pointer;user-select:none}
    .box{width:20px;height:20px;display:grid;place-items:center;border-radius:6px;background:#0d1322;
         border:1px solid #1d2233;color:#8892a6}
    .ev[data-s="1"] .box{background:#05281f;border-color:#0e3;color:#8ff1c9}
    .ev[data-s="-1"] .box{background:#2a1214;border-color:#b22;color:#f7a0a0}
    .ok{color:#22c55e}.no{color:#ef4444}.muted{color:#9aa3b2}
    pre{white-space:pre-wrap;background:#0d1322;border:1px solid #20283a;border-radius:8px;padding:8px}
    #build{font-weight:700}
  </style>
  <noscript><div class="wrap"><div class="banner no">⚠️ JavaScript désactivé – active‑le pour tester.</div></div></noscript>
</head>
<body>
  <div class="wrap">
    <div class="banner"><div id="build">BUILD: PWA-DIAG-COURT-2026‑01‑21</div></div>

    <div class="banner">
      <div>JS s’exécute : <b id="js" class="no">non</b></div>
      <div>Message d’erreur : <span id="err" class="muted">aucune</span></div>
    </div>

    <h2>Preuves (tri‑état)</h2>
    <p class="muted">Clique → Inconnue → ✓ → ✕</p>
    <div id="evs" class="row"></div>

    <h2 style="margin-top:18px">Fantômes candidats</h2>
    <div id="out" class="banner muted">0 fantôme</div>

    <div class="banner">
      <div>Debug console :</div>
      <pre id="log"></pre>
    </div>
  </div>

  <script>
  (function(){
    const log = (m)=>{ const el=document.getElementById('log'); el.textContent += m + "\n"; console.log(m); };
    try{
      // 1) Indiquer que JS tourne
      document.getElementById('js').textContent='oui';
      document.getElementById('js').className='ok';
      log('JS OK');

      // 2) Données mini
      const EVIDENCES=[['EMF5','EMF Level 5'],['DOTS','D.O.T.S'],['WRITING','Ghost Writing']];
      const GHOSTS=[
        {name:'Spirit',evidences:['EMF5','WRITING']},
        {name:'Wraith',evidences:['EMF5','DOTS']},
        {name:'Deogen',evidences:['WRITING','DOTS']},
      ];
      const state=Object.fromEntries(EVIDENCES.map(([k])=>[k,0])); // -1/0/1

      // 3) UI evidences
      const $evs=document.getElementById('evs');
      const $out=document.getElementById('out');
      function cycle(s){return s===0?1:(s===1?-1:0)}
      function inc(){return Object.entries(state).filter(([,v])=>v===1).map(([k])=>k)}
      function exc(){return Object.entries(state).filter(([,v])=>v===-1).map(([k])=>k)}
      function candidate(g){const a=inc(), b=exc(); return a.every(k=>g.evidences.includes(k)) && !b.some(k=>g.evidences.includes(k))}
      function render(){
        $evs.innerHTML='';
        for(const [k,label] of EVIDENCES){
          const d=document.createElement('div'); d.className='ev'; d.dataset.k=k; d.dataset.s=String(state[k]);
          d.innerHTML=`<span class="box">${state[k]===1?'✓':state[k]===-1?'✕':''}</span>${label}`;
          d.onclick=()=>{ state[k]=cycle(state[k]); render(); };
          $evs.appendChild(d);
        }
        const list=GHOSTS.filter(candidate);
        $out.textContent = (list.length)+' '+(list.length>1?'fantômes':'fantôme')+ (list.length?(' : '+list.map(g=>g.name).join(', ')):'');
        $out.className='banner '+(list.length?'ok':'muted');
      }
      render();
      log('UI ready');
    }catch(e){
      document.getElementById('err').textContent = e && e.message ? e.message : String(e);
      document.getElementById('err').className = 'no';
      log('ERROR: '+(e && e.stack ? e.stack : e));
    }
  })();
  </script>
</body>
</html>
